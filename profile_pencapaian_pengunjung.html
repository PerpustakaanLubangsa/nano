<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pencapaian - Snowy Digital Library</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
<style>
:root {
--bg-page: #f8f9fa;
--bg-card: #ffffff;
--text-primary: #202124;
--text-secondary: #5f6368;
--border-color: #dadce0;
--accent-color: #1a73e8;
--card-inner: #f1f3f4;
--toast-bg: #202124;
--toast-text: #ffffff;
}
@media (prefers-color-scheme: dark) {
:root {
--bg-page: #000000;
--bg-card: #000000;
--text-primary: #e8eaed;
--text-secondary: #9aa0a6;
--border-color: #333333;
--accent-color: #8ab4f8;
--card-inner: #171717;
--toast-bg: #2d2e31;
}
}
* {
margin: 0;
padding: 0;
box-sizing: border-box;
font-family: 'Plus Jakarta Sans', sans-serif;
}
body {
background-color: var(--bg-page);
color: var(--text-primary);
height: 100vh;
display: flex;
align-items: center;
justify-content: center;
padding: 20px;
overflow: hidden;
position: relative;
}
.modal-content {
background-color: var(--bg-card);
border: 1px solid var(--border-color);
border-radius: 28px;
width: 100%;
max-width: 360px;
display: flex;
flex-direction: column;
overflow: hidden;
box-shadow: 0 10px 30px rgba(0,0,0,0.1);
}
.modal-body {
padding: 24px;
overflow-y: auto;
}
.profile-header {
text-align: center;
margin-bottom: 24px;
perspective: 1000px;
}
.rank-img {
width: 120px;
height: 120px;
margin: 0 auto 12px;
display: block;
object-fit: contain;
opacity: 0;
transform: scale(0.5) rotateY(90deg);
animation: rankAppear 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
animation-delay: 0.5s;
}
@keyframes rankAppear {
0% { opacity: 0; transform: scale(0.3) rotateY(180deg); filter: brightness(5); }
100% { opacity: 1; transform: scale(1) rotateY(0deg); filter: brightness(1); }
}
.rank-name {
font-size: 12px;
font-weight: 800;
letter-spacing: 2px;
text-transform: uppercase;
color: var(--accent-color);
margin-bottom: 4px;
opacity: 0;
animation: fadeInUp 0.5s ease forwards;
animation-delay: 1.1s;
}
.user-name {
font-size: 20px;
font-weight: 700;
margin-bottom: 2px;
opacity: 0;
animation: fadeInUp 0.5s ease forwards;
animation-delay: 1.3s;
}
.user-meta {
font-size: 11px;
font-weight: 600;
color: var(--text-secondary);
text-transform: uppercase;
opacity: 0;
animation: fadeInUp 0.5s ease forwards;
animation-delay: 1.4s;
}
@keyframes fadeInUp {
from { opacity: 0; transform: translateY(10px); }
to { opacity: 1; transform: translateY(0); }
}
.stats-grid {
display: grid;
grid-template-columns: 1fr 1fr;
gap: 12px;
margin-bottom: 12px;
opacity: 0;
animation: fadeInUp 0.5s ease forwards;
animation-delay: 1.6s;
}
.stat-card {
background-color: var(--card-inner);
padding: 12px;
border-radius: 16px;
text-align: center;
border: 1px solid var(--border-color);
}
.stat-label {
font-size: 9px;
font-weight: 700;
color: var(--text-secondary);
text-transform: uppercase;
display: block;
margin-bottom: 4px;
}
.stat-value {
font-size: 18px;
font-weight: 800;
color: var(--text-primary);
}
.history-box {
background-color: var(--card-inner);
padding: 16px;
border-radius: 16px;
border: 1px solid var(--border-color);
opacity: 0;
animation: fadeInUp 0.5s ease forwards;
animation-delay: 1.8s;
}
.history-label {
font-size: 10px;
font-weight: 700;
color: var(--text-secondary);
text-transform: uppercase;
margin-bottom: 8px;
display: block;
}
.history-content {
font-size: 11px;
line-height: 1.5;
color: var(--text-primary);
max-height: 80px;
overflow-y: auto;
font-style: italic;
}
.modal-footer {
padding: 16px 24px 24px;
opacity: 0;
animation: fadeIn 0.5s ease forwards;
animation-delay: 2s;
}
@keyframes fadeIn { to { opacity: 1; } }
.btn-done {
width: 100%;
padding: 14px;
background-color: var(--accent-color);
color: #ffffff;
border: none;
border-radius: 24px;
font-size: 14px;
font-weight: 600;
cursor: pointer;
}
.loading-state {
text-align: center;
padding: 60px 0;
}
.spinner {
width: 40px;
height: 40px;
border: 4px solid var(--card-inner);
border-top: 4px solid var(--accent-color);
border-radius: 50%;
margin: 0 auto 16px;
animation: spin 1s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }
.gemini-toast {
position: fixed;
bottom: 24px;
left: 50%;
transform: translateX(-50%) translateY(150%);
background-color: var(--toast-bg);
color: var(--toast-text);
padding: 14px 20px;
border-radius: 20px;
display: flex;
flex-direction: column;
gap: 12px;
width: 320px;
box-shadow: 0 12px 32px rgba(0,0,0,0.3);
transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
z-index: 9999;
}
.gemini-toast.active { transform: translateX(-50%) translateY(0); }
.toast-header {
display: flex;
justify-content: space-between;
align-items: center;
}
.toast-msg { font-size: 13px; font-weight: 500; line-height: 1.4; }
.btn-close-toast {
background: none;
border: none;
color: #9aa0a6;
cursor: pointer;
font-size: 20px;
padding-left: 10px;
}
.toast-actions { display: flex; gap: 12px; justify-content: flex-end; }
.btn-icon-toast {
background: #3c4043;
border: none;
color: white;
width: 36px;
height: 36px;
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
}
.btn-toast {
padding: 7px 18px;
border-radius: 18px;
border: 1px solid #5f6368;
background: none;
color: white;
font-size: 12px;
font-weight: 600;
cursor: pointer;
}
.toast-input-area { display: none; flex-direction: column; gap: 10px; }
.toast-textarea {
width: 100%;
background: #3c4043;
border: 1px solid #5f6368;
border-radius: 12px;
color: white;
padding: 10px;
font-size: 13px;
resize: none;
outline: none;
}
.btn-submit-feedback {
align-self: flex-end;
background: var(--accent-color);
border: none;
color: white;
padding: 7px 16px;
border-radius: 14px;
font-size: 12px;
font-weight: 600;
cursor: pointer;
}
</style>
</head>
<body>
<div class="modal-content">
<div id="modalBody" class="modal-body">
<div class="loading-state"><div class="spinner"></div></div>
</div>
<div id="modalFooter" class="modal-footer" style="display: none;">
<button onclick="window.location.href='form.html'" class="btn-done">SELESAI</button>
</div>
</div>
<div id="feedbackToast" class="gemini-toast">
<div class="toast-header">
<div id="toastMsg" class="toast-msg">Apakah Kamu Menyukai Perpustakaan Lubangsa?</div>
<button onclick="closeToast()" class="btn-close-toast"><i class="fa-solid fa-xmark"></i></button>
</div>
<div id="toastActions" class="toast-actions">
<button onclick="handleLike(true)" class="btn-icon-toast" title="Like"><i class="fa-regular fa-thumbs-up"></i></button>
<button onclick="handleLike(false)" class="btn-icon-toast" title="Unlike"><i class="fa-regular fa-thumbs-down"></i></button>
</div>
<div id="suggestionArea" class="toast-input-area">
<textarea id="suggestionText" class="toast-textarea" rows="3" placeholder="Saran atau kritik Anda..."></textarea>
<button onclick="submitFeedback()" class="btn-submit-feedback">Kirim Masukan</button>
</div>
</div>
<script type="module">
import { supabase } from './supa/supa.js';
const toast = document.getElementById('feedbackToast');
const toastMsg = document.getElementById('toastMsg');
const toastActions = document.getElementById('toastActions');
const suggestionArea = document.getElementById('suggestionArea');
let feedbackState = {
nama: '',
is_liked: null
};
function showToast() { setTimeout(() => toast.classList.add('active'), 2500); }
window.closeToast = () => { toast.classList.remove('active'); };
window.handleLike = (liked) => {
feedbackState.is_liked = liked;
toast.classList.remove('active');
setTimeout(() => {
toastMsg.innerText = "Apakah kamu memiliki saran atau kritik untuk kami?";
toastActions.innerHTML = `<button onclick="handleSuggestion(true)" class="btn-toast">Ya</button><button onclick="handleSuggestion(false)" class="btn-toast">Tidak</button>`;
toast.classList.add('active');
}, 600);
};
window.handleSuggestion = async (wants) => {
if (wants) {
toastActions.style.display = 'none';
suggestionArea.style.display = 'flex';
document.getElementById('suggestionText').focus();
} else {
await sendToSupabase('');
finishToast();
}
};
window.submitFeedback = async () => {
const msg = document.getElementById('suggestionText').value.trim();
suggestionArea.style.display = 'none';
await sendToSupabase(msg);
finishToast();
};
async function sendToSupabase(pesan) {
try {
await supabase.from('feedback').insert([{
nama: feedbackState.nama,
is_liked: feedbackState.is_liked,
pesan: pesan
}]);
} catch (err) {
console.error("Gagal simpan feedback:", err);
}
}
function finishToast() {
toastMsg.innerText = "Terima kasih atas masukan anda";
toastActions.style.display = 'none';
setTimeout(() => toast.classList.remove('active'), 2000);
}
async function init() {
const body = document.getElementById('modalBody');
const footer = document.getElementById('modalFooter');
const storage = sessionStorage.getItem('last_guest');
if (!storage) { window.location.href = 'form.html'; return; }
const guest = JSON.parse(storage);
feedbackState.nama = guest.nama;
const currentYear = new Date().getFullYear();
try {
const [resUser, resLogs] = await Promise.all([
supabase.from('anggota').select('nama, jenjang, kamar').eq('nama', guest.nama).maybeSingle(),
supabase.from('data_pengunjung').select('*').eq('nama', guest.nama)
]);
if (resUser.error) throw resUser.error;
const profile = resUser.data || { nama: guest.nama, jenjang: '-', kamar: '-' };
const allLogs = resLogs.data || [];
const logs = allLogs.filter(item => {
const dateStr = item.tanggal_kunjungan || item.created_at;
return dateStr && new Date(dateStr).getFullYear() === currentYear;
});
const totalKunjungan = logs.length;
const totalBaca = logs.filter(l => l.aktivitas === 'Baca').length;
const totalPinjam = logs.filter(l => l.aktivitas === 'Pinjam').length;
const historyItems = [...new Set(logs.filter(l => l.judul_buku).map(l => l.judul_buku))].reverse();
const historyText = historyItems.join(', ');
let rankName = "Warrior";
if (totalKunjungan >= 100) rankName = "Immortal";
else if (totalKunjungan >= 80) rankName = "Glory";
else if (totalKunjungan >= 60) rankName = "Honor";
else if (totalKunjungan >= 50) rankName = "Mythic";
else if (totalKunjungan >= 40) rankName = "Legend";
else if (totalKunjungan >= 30) rankName = "Epic";
else if (totalKunjungan >= 20) rankName = "Grandmaster";
else if (totalKunjungan >= 10) rankName = "Master";
else if (totalKunjungan >= 5) rankName = "Elite";
body.innerHTML = `
<div class="profile-header">
<img src="image/rank/${rankName}.jpg" class="rank-img" alt="${rankName}" onerror="this.src='image/rank/Warrior.jpg'">
<div class="rank-name">${rankName}</div>
<div class="user-name">${profile.nama}</div>
<div class="user-meta">${profile.jenjang} â€¢ ${profile.kamar}</div>
</div>
<div class="stats-grid">
<div class="stat-card" style="grid-column: span 2;">
<span class="stat-label">TOTAL KUNJUNGAN ${currentYear}</span>
<span class="stat-value">${totalKunjungan}</span>
</div>
</div>
<div class="stats-grid">
<div class="stat-card"><span class="stat-label">BACA</span><span class="stat-value">${totalBaca}</span></div>
<div class="stat-card"><span class="stat-label">PINJAM</span><span class="stat-value">${totalPinjam}</span></div>
</div>
<div class="history-box">
<span class="history-label">RIWAYAT BUKU ${currentYear}</span>
<div class="history-content">${historyText || 'Belum ada riwayat.'}</div>
</div>`;
footer.style.display = 'block';
showToast();
} catch (e) {
console.error(e);
body.innerHTML = `<div class="loading-state">Gagal memuat data: ${e.message}</div>`;
}
}
init();
</script>
</body>
</html>