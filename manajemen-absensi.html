<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jadwal Perpustakaan | Gemini Edition</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root {
--bg: #ffffff;
--surface: #f7f9fc;
--text: #1f1f1f;
--border: #e3e3e3;
--accent: #1a73e8;
--danger: #d93025;
--scroll-bar: #e0e0e0;
--scroll-thumb: #cccccc;
}
@media (prefers-color-scheme: dark) {
:root {
--bg: #000000;
--surface: #111111;
--text: #e3e3e3;
--border: #222222;
--accent: #ffffff;
--danger: #ff6b6b;
--scroll-bar: #1a1a1a;
--scroll-thumb: #333333;
}
}
* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
::-webkit-scrollbar { width: 6px; height: 6px; }
::-webkit-scrollbar-track { background: var(--scroll-bar); }
::-webkit-scrollbar-thumb { background: var(--scroll-thumb); border-radius: 10px; }
body {
font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
background-color: var(--bg);
color: var(--text);
line-height: 1.5;
overflow-x: hidden;
}
main { max-width: 800px; margin: 0 auto; padding: 40px 20px 100px; }
.day-section { margin-bottom: 60px; }
.day-header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
.day-header h2 { font-size: 28px; font-weight: 300; }
.day-divider { height: 1px; flex: 1; background: var(--border); }
.shift-group { margin-bottom: 32px; }
.shift-info { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 12px; }
.shift-label { font-size: 11px; font-weight: 700; text-transform: uppercase; letter-spacing: 0.1em; color: var(--accent); }
.shift-time { font-size: 10px; opacity: 0.5; font-weight: 500; }
.tag-container { display: flex; flex-wrap: wrap; gap: 8px; }
.name-tag {
background: var(--bg);
border: 1px solid var(--border);
padding: 6px 12px;
border-radius: 10px;
font-size: 14px;
display: flex;
align-items: center;
gap: 8px;
}
.btn-del-tag { background: none; border: none; color: var(--text); opacity: 0.3; cursor: pointer; font-size: 18px; line-height: 1; }
.btn-add-trigger {
background: var(--surface);
border: 1px solid var(--border);
color: var(--text);
font-size: 11px;
padding: 6px 16px;
border-radius: 20px;
cursor: pointer;
font-weight: 500;
transition: background 0.2s;
}
.btn-add-trigger:active { background: var(--border); }
.fab {
position: fixed;
bottom: 24px;
right: 24px;
width: 56px;
height: 56px;
background: var(--surface);
border: 1px solid var(--border);
border-radius: 50%;
color: var(--text);
font-size: 24px;
display: flex;
align-items: center;
justify-content: center;
cursor: pointer;
box-shadow: 0 4px 12px rgba(0,0,0,0.1);
z-index: 100;
}
.drawer {
position: fixed;
top: 0;
right: -100%;
width: 100%;
max-width: 400px;
height: 100%;
background: var(--bg);
border-left: 1px solid var(--border);
z-index: 200;
padding: 32px;
transition: right 0.3s ease;
overflow-y: auto;
}
.drawer.active { right: 0; }
.overlay {
position: fixed;
inset: 0;
background: rgba(0,0,0,0.7);
display: none;
z-index: 150;
}
.overlay.active { display: block; }
.drawer-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 32px; }
.drawer-section { margin-bottom: 40px; }
.drawer-section h3 { font-size: 11px; text-transform: uppercase; letter-spacing: 0.1em; opacity: 0.5; margin-bottom: 16px; }
.data-card { background: var(--surface); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; }
.data-table { width: 100%; border-collapse: collapse; font-size: 14px; }
.data-table td { padding: 12px 16px; border-bottom: 1px solid var(--border); }
.input-group { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
input {
background: var(--surface);
border: 1px solid var(--border);
color: var(--text);
padding: 12px 16px;
border-radius: 12px;
outline: none;
font-size: 14px;
}
.btn-submit {
background: var(--text);
color: var(--bg);
border: none;
padding: 14px;
border-radius: 12px;
font-weight: 600;
cursor: pointer;
}
.modal {
position: fixed;
inset: 0;
background: rgba(0,0,0,0.85);
z-index: 400;
display: none;
align-items: center;
justify-content: center;
padding: 20px;
}
.modal-content { 
background: var(--bg); 
padding: 32px; 
border-radius: 32px; 
width: 100%; 
max-width: 400px; 
border: 1px solid var(--border);
}
.pustakawan-list {
max-height: 300px;
overflow-y: auto;
margin: 20px 0;
display: flex;
flex-direction: column;
gap: 10px;
}
.pustakawan-item {
display: flex;
align-items: center;
gap: 12px;
padding: 12px;
background: var(--surface);
border-radius: 16px;
cursor: pointer;
}
.pustakawan-item input { width: auto; accent-color: var(--accent); }
.btn-confirm { background: var(--danger); color: white; border: none; width: 100%; padding: 14px; border-radius: 12px; margin-top: 24px; font-weight: 600; cursor: pointer; }
.btn-cancel { background: none; border: none; color: var(--text); opacity: 0.5; margin-top: 12px; font-size: 14px; width: 100%; cursor: pointer; }
</style>
</head>
<body>
<div id="overlay" class="overlay" onclick="toggleDrawer()"></div>
<button class="fab" onclick="toggleDrawer()">&#9776;</button>
<aside id="drawer" class="drawer">
<div class="drawer-header">
<h2>Database</h2>
<button onclick="toggleDrawer()" style="background:none; border:none; color:var(--text); font-size:24px; cursor:pointer;">&times;</button>
</div>
<div class="drawer-section">
<h3>Tambah Petugas Baru</h3>
<div class="input-group">
<input type="text" id="namaPetugas" placeholder="Nama Lengkap Petugas">
<button onclick="window.tambahMasterPetugas()" class="btn-submit">TAMBAHKAN PETUGAS</button>
</div>
<h3>Daftar Petugas</h3>
<div class="data-card">
<table class="data-table"><tbody id="tableNama"></tbody></table>
</div>
</div>
<div class="drawer-section">
<h3>Konfigurasi Shift</h3>
<div class="input-group">
<input type="text" id="labelShift" placeholder="Label (Pagi)">
<input type="text" id="waktuShift" placeholder="Waktu (08:00 - 12:00)">
<button onclick="window.tambahMasterShift()" class="btn-submit">DAFTARKAN SHIFT</button>
</div>
<div class="data-card">
<table class="data-table"><tbody id="tableShift"></tbody></table>
</div>
</div>
</aside>
<main id="boardVertical"></main>
<div id="modalMulti" class="modal">
<div class="modal-content">
<h3 id="modalTitle">Pilih Petugas</h3>
<div id="pustakawanChecklist" class="pustakawan-list"></div>
<button id="btnSaveMulti" class="btn-submit" style="width: 100%;">SIMPAN SEKALIGUS</button>
<button onclick="closeModal()" class="btn-cancel">Batal</button>
</div>
</div>
<div id="modalConfirm" class="modal">
<div class="modal-content">
<h3 id="confirmTitle">Konfirmasi</h3>
<p id="confirmMessage" style="font-size:14px; opacity:0.6; margin-top:8px;"></p>
<button id="btnConfirmAction" class="btn-confirm">HAPUS PERMANEN</button>
<button onclick="closeConfirm()" class="btn-cancel">Batal</button>
</div>
</div>
<script type="module">
import { supabase as client } from './supa/supa.js';
const HARI = ['Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu', 'Minggu'];
let masterNama = [];
let masterShift = [];
let activeContext = { hari: '', shift: '' };
window.toggleDrawer = () => {
document.getElementById('drawer').classList.toggle('active');
document.getElementById('overlay').classList.toggle('active');
};
async function init() {
await Promise.all([loadMasterNama(), loadMasterShift()]);
renderBoard();
await loadJadwalExisting();
}
async function loadMasterNama() {
let { data } = await client.from('petugas_master').select('id, nama').order('nama');
masterNama = data || [];
document.getElementById('tableNama').innerHTML = masterNama.map(n => `
<tr>
<td><div style="font-weight:500">${n.nama}</div></td>
<td style="text-align:right"><button onclick="window.confirmHapusPetugas(${n.id}, '${n.nama}')" style="background:none; border:none; color:var(--text); opacity:0.3; font-size:18px; cursor:pointer;">&times;</button></td>
</tr>`).join('');
}
async function loadMasterShift() {
let { data } = await client.from('jam_master').select('id, label, waktu').order('id');
masterShift = data || [];
document.getElementById('tableShift').innerHTML = masterShift.map(s => `
<tr>
<td><div style="font-weight:500">${s.label}</div><div style="font-size:11px; opacity:0.4">${s.waktu}</div></td>
<td style="text-align:right"><button onclick="window.confirmHapusShift(${s.id}, '${s.label}')" style="background:none; border:none; color:var(--text); opacity:0.3; font-size:18px; cursor:pointer;">&times;</button></td>
</tr>`).join('');
}
function renderBoard() {
const board = document.getElementById('boardVertical');
board.innerHTML = HARI.map(hari => `
<section class="day-section">
<div class="day-header">
<h2>${hari}</h2>
<div class="day-divider"></div>
</div>
<div class="shift-container">
${masterShift.map(s => `
<div class="shift-group">
<div class="shift-info">
<div>
<div class="shift-label">${s.label}</div>
<div class="shift-time">${s.waktu}</div>
</div>
<button class="btn-add-trigger" onclick="window.openPilihPetugas('${hari}', '${s.waktu}')">+ Pilih Petugas</button>
</div>
<div id="list-${hari}-${s.waktu.replace(/\s+/g, '')}" class="tag-container"></div>
</div>`).join('')}
</div>
</section>`).join('');
}
window.openPilihPetugas = (hari, shift) => {
activeContext = { hari, shift };
document.getElementById('modalTitle').innerText = `${hari} (${shift})`;
const list = document.getElementById('pustakawanChecklist');
list.innerHTML = masterNama.map(n => `
<label class="pustakawan-item">
<input type="checkbox" value="${n.nama}">
<span>${n.nama}</span>
</label>`).join('');
document.getElementById('modalMulti').style.display = 'flex';
};
window.closeModal = () => { document.getElementById('modalMulti').style.display = 'none'; };
document.getElementById('btnSaveMulti').onclick = async () => {
const checkboxes = document.querySelectorAll('#pustakawanChecklist input:checked');
const names = Array.from(checkboxes).map(cb => cb.value);
if(names.length > 0) {
const payloads = names.map(nama => ({ 
hari: activeContext.hari, 
shift: activeContext.shift, 
nama: nama 
}));
const { error } = await client.from('jadwal_detail').insert(payloads);
if(error) alert("Error simpan: " + error.message);
}
window.closeModal();
await loadJadwalExisting();
};
async function loadJadwalExisting() {
let { data } = await client.from('jadwal_detail').select('id, nama, hari, shift');
HARI.forEach(hari => {
masterShift.forEach(s => {
const id = `list-${hari}-${s.waktu.replace(/\s+/g, '')}`;
const container = document.getElementById(id);
if(container) {
const filtered = (data || []).filter(j => j.hari === hari && j.shift === s.waktu);
container.innerHTML = filtered.map(j => `
<div class="name-tag">
<span>${j.nama}</span>
<button onclick="window.hapusJadwalEntry(${j.id})" class="btn-del-tag">&times;</button>
</div>`).join('');
}
});
});
}
window.hapusJadwalEntry = async (id) => {
await client.from('jadwal_detail').delete().eq('id', id);
await loadJadwalExisting();
};
window.tambahMasterPetugas = async () => {
const nama = document.getElementById('namaPetugas').value;
if(!nama) return;
const { error } = await client.from('petugas_master').insert([{ nama }]);
if(error) {
alert("Error tambah petugas: " + error.message);
} else {
document.getElementById('namaPetugas').value = '';
await loadMasterNama();
}
};
window.tambahMasterShift = async () => {
const label = document.getElementById('labelShift').value;
const waktu = document.getElementById('waktuShift').value;
if(!label || !waktu) return;
const { error } = await client.from('jam_master').insert([{ label, waktu }]);
if(error) {
alert("Error tambah shift: " + error.message);
} else {
document.getElementById('labelShift').value = '';
document.getElementById('waktuShift').value = '';
await loadMasterShift();
renderBoard();
await loadJadwalExisting();
}
};
window.confirmHapusPetugas = (id, nama) => {
document.getElementById('confirmMessage').innerText = `Hapus petugas ${nama} dari database?`;
document.getElementById('modalConfirm').style.display = 'flex';
document.getElementById('btnConfirmAction').onclick = async () => {
await client.from('petugas_master').delete().eq('id', id);
await loadMasterNama();
closeConfirm();
};
};
window.confirmHapusShift = (id, label) => {
document.getElementById('confirmMessage').innerText = `Hapus shift ${label}? Tindakan ini permanen.`;
document.getElementById('modalConfirm').style.display = 'flex';
document.getElementById('btnConfirmAction').onclick = async () => {
await client.from('jam_master').delete().eq('id', id);
await loadMasterShift();
renderBoard();
await loadJadwalExisting();
closeConfirm();
};
};
window.closeConfirm = () => { document.getElementById('modalConfirm').style.display = 'none'; };
init();
</script>
</body>
</html>